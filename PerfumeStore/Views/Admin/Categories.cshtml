@model List<PerfumeStore.Models.Category>
@{
    ViewData["Title"] = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar") ? "إدارة الأقسام" : "Manage Categories";
    var isArabic = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar");
    Layout = "_AdminLayout";
}

<!-- Page Header -->
<div class="page-header animate-fade-up">
    <div class="header-left">
        <h1>@ViewData["Title"]</h1>
        <p>@(isArabic ? "إدارة وتصنيف المنتجات في المتجر" : "Manage and classify store products")</p>
    </div>
    <div class="header-right">
        <a href="/Admin/CreateCategory" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            @(isArabic ? "إضافة قسم جديد" : "Add New Category")
        </a>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success animate-fade-up" style="background: #e8f5e9; color: #2e7d32; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px solid #c8e6c9; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-check-circle"></i> @TempData["Success"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-error animate-fade-up" style="background: #ffebee; color: #c62828; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px solid #ffcdd2; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-exclamation-circle"></i> @TempData["Error"]
    </div>
}

<!-- Toolbar (Filter & Search) -->
<div class="card animate-fade-up delay-1 mb-4" style="margin-bottom: 1.5rem;">
    <div class="card-body" style="padding: 1.2rem;">
        <div class="filter-container" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div class="search-wrapper" style="flex: 1; position: relative;">
                <i class="fas fa-search search-icon" style="position: absolute; top: 50%; transform: translateY(-50%); @(isArabic ? "right: 15px;" : "left: 15px;") color: #94a3b8;"></i>
                <input type="text" id="searchInput" placeholder="@(isArabic ? "بحث باسم القسم..." : "Search by category name...")" onkeyup="filterTable()" style="width: 100%; padding: 0.8rem 2.5rem; border: 1px solid #e2e8f0; border-radius: 10px; background: #f8fafc;">
            </div>

            <div class="filters-wrapper">
                <div class="select-wrapper" style="position: relative;">
                    <select id="statusFilter" onchange="filterTable()" style="padding: 0.8rem 2rem 0.8rem 1rem; border: 1px solid #e2e8f0; border-radius: 10px; background: #fff; cursor: pointer; appearance: none; min-width: 150px;">
                        <option value="">@(isArabic ? "كل الحالات" : "All Status")</option>
                        <option value="active">@(isArabic ? "نشط" : "Active")</option>
                        <option value="inactive">@(isArabic ? "معطل" : "Inactive")</option>
                    </select>
                    <i class="fas fa-chevron-down arrow-icon" style="position: absolute; top: 50%; transform: translateY(-50%); @(isArabic ? "left: 15px;" : "right: 15px;") color: #94a3b8; pointer-events: none;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Categories Table -->
<div class="card animate-fade-up delay-2">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="premium-table" id="categoriesTable">
                <thead>
                    <tr>
                        <th>@(isArabic ? "القسم" : "Category")</th>
                        <th>@(isArabic ? "الترتيب" : "Order")</th>
                        <th>@(isArabic ? "المنتجات" : "Products")</th>
                        <th>@(isArabic ? "الحالة" : "Status")</th>
                        <th class="text-end">@(isArabic ? "إجراءات" : "Actions")</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var cat in Model.OrderBy(c => c.DisplayOrder))
                    {
                        var statusClass = cat.IsActive ? "active" : "inactive";

                        <tr class="category-row" data-status="@statusClass">
                            <td>
                                <div class="product-info-cell" style="display: flex; align-items: center; gap: 1rem;">
                                    <div class="img-box" style="width: 50px; height: 50px; border-radius: 10px; overflow: hidden; border: 1px solid #e2e8f0;">
                                        @if (!string.IsNullOrEmpty(cat.ImageUrl))
                                        {
                                            <img src="@cat.ImageUrl" alt="@cat.Name" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" />
                                        }
                                        else
                                        {
                                            <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#f1f5f9; color:#94a3b8;">
                                                <i class="fas fa-image"></i>
                                            </div>
                                        }
                                    </div>
                                    <div class="txt-content">
                                        <h4 class="name" style="margin: 0 0 4px; font-size: 0.95rem; font-weight: 700; color: #1e293b;">@(isArabic? cat.NameAr: cat.Name)</h4>
                                        <span class="brand" style="font-size: 0.8rem; color: #64748b;">
                                            @(isArabic? cat.Name: cat.NameAr)
                                        </span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="category-pill" style="display: inline-block; padding: 4px 10px; background: #f8fafc; border: 1px solid #e2e8f0; color: #64748b; border-radius: 6px; font-size: 0.85rem; font-weight: 600;">
                                    #@cat.DisplayOrder
                                </span>
                            </td>
                            <td>
                                <span class="category-pill" style="display: inline-block; padding: 4px 10px; background: #eff6ff; border: 1px solid rgba(0,40,85,0.1); color: #002855; border-radius: 6px; font-size: 0.85rem; font-weight: 600;">
                                    <i class="fas fa-box" style="margin-inline-end: 5px;"></i> @cat.Products.Count
                                </span>
                            </td>
                            <td>
                                <span class="status-badge @statusClass">
                                    @(cat.IsActive ? (isArabic ? "نشط" : "Active") : (isArabic ? "معطل" : "Inactive"))
                                </span>
                            </td>
                            <td>
                                <div class="action-btns justify-end" style="display: flex; gap: 8px; justify-content: flex-end;">
                                    <a href="/Admin/EditCategory/@cat.Id" class="action-btn edit" title="@(isArabic ? "تعديل" : "Edit")">
                                        <i class="fas fa-pen"></i>
                                    </a>

                                    <form action="/Admin/DeleteCategory/@cat.Id" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="action-btn delete" onclick="return confirm('@(isArabic ? "هل أنت متأكد من حذف هذا القسم؟" : "Confirm delete?")')" title="@(isArabic ? "حذف" : "Delete")">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @if (!Model.Any())
            {
                <div class="empty-data" style="padding: 3rem; text-align: center;">
                    <div class="empty-img" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <h3 style="font-size: 1.2rem; color: #1e293b; margin-bottom: 0.5rem;">@(isArabic ? "لا توجد أقسام" : "No Categories Found")</h3>
                </div>
            }
        </div>
    </div>
</div>

<script>
    function filterTable() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;

        const rows = document.querySelectorAll('.category-row');

        rows.forEach(row => {
            // Get text from name and English name (brand class used for subtitle)
            const name = row.querySelector('.name').textContent.toLowerCase();
            const subName = row.querySelector('.brand').textContent.toLowerCase();
            const rowStatus = row.getAttribute('data-status');

            // Logic conditions
            const matchesSearch = name.includes(searchText) || subName.includes(searchText);
            const matchesStatus = statusFilter === "" || rowStatus === statusFilter;

            if (matchesSearch && matchesStatus) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }
</script>