@model PerfumeStore.ViewModels.CheckoutViewModel
@{
    ViewData["Title"] = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar") ? "إتمام الطلب" : "Checkout";
    var isArabic = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar");
}

<div class="checkout-page-wrapper animate-fade-up">
    <div class="container">
        <div class="checkout-header-centered">
            <h1>@ViewData["Title"]</h1>
            <div class="trust-badges">
                <span class="badge"><i class="fas fa-lock"></i> @(isArabic ? "تشفير SSL" : "SSL Encrypted")</span>
                <span class="badge"><i class="fas fa-shield-alt"></i> @(isArabic ? "دفع آمن" : "Secure Payment")</span>
            </div>
        </div>

        <form asp-action="Checkout" method="post" id="checkoutForm">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="UserId" />

            <div class="checkout-grid-premium">
                <!-- Left Side: Information -->
                <div class="checkout-main">
                    <!-- Shipping Section -->
                    <div class="checkout-card">
                        <div class="card-header-clean">
                            <span class="step-circle">1</span>
                            <h2>@(isArabic ? "عنوان التوصيل" : "Shipping Address")</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-grid-2">
                                <div class="form-group-float">
                                    <input asp-for="FirstName" class="form-input" placeholder=" " required />
                                    <label asp-for="FirstName">@(isArabic ? "الاسم الأول" : "First Name")</label>
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>
                                <div class="form-group-float">
                                    <input asp-for="LastName" class="form-input" placeholder=" " required />
                                    <label asp-for="LastName">@(isArabic ? "الاسم الأخير" : "Last Name")</label>
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group-float">
                                <input asp-for="Email" type="email" class="form-input" placeholder=" " required />
                                <label asp-for="Email">@(isArabic ? "البريد الإلكتروني" : "Email Address")</label>
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>

                            <div class="form-group-float">
                                <input asp-for="Phone" type="tel" class="form-input" placeholder=" " required />
                                <label asp-for="Phone">@(isArabic ? "رقم الهاتف" : "Phone Number")</label>
                                <span asp-validation-for="Phone" class="text-danger"></span>
                            </div>

                            <div class="form-grid-2">
                                <div class="form-group-float">
                                    <select asp-for="Country" class="form-input" disabled>
                                        <option value="Oman" selected>@(isArabic ? "سلطنة عمان" : "Sultanate of Oman")</option>
                                    </select>
                                    <label asp-for="Country">@(isArabic ? "الدولة" : "Country")</label>
                                </div>
                                <div class="form-group-float">
                                    <input asp-for="City" class="form-input" placeholder=" " required />
                                    <label asp-for="City">@(isArabic ? "المدينة / الولاية" : "City / Wilayat")</label>
                                    <span asp-validation-for="City" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group-float">
                                <input asp-for="Address" class="form-input" placeholder=" " required />
                                <label asp-for="Address">@(isArabic ? "العنوان (الشارع، رقم المنزل)" : "Street Address")</label>
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>

                            <div class="form-group-float">
                                <textarea asp-for="Notes" class="form-input" placeholder=" " rows="2"></textarea>
                                <label asp-for="Notes">@(isArabic ? "ملاحظات التوصيل (اختياري)" : "Delivery Notes (Optional)")</label>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method Section -->
                    <div class="checkout-card mt-4">
                        <div class="card-header-clean">
                            <span class="step-circle">2</span>
                            <h2>@(isArabic ? "طريقة الدفع" : "Payment Method")</h2>
                        </div>
                        <div class="card-body">
                            <div class="payment-selection-grid">
                                <!-- Cash on Delivery -->
                                <label class="payment-method-card selected">
                                    <input type="radio" asp-for="PaymentMethod" value="CashOnDelivery" checked name="PaymentMethod" onchange="updatePaymentSelection(this)" />
                                    <div class="card-content">
                                        <div class="method-icon"><i class="fas fa-money-bill-wave"></i></div>
                                        <div class="method-details">
                                            <span class="title">@(isArabic ? "الدفع عند الاستلام" : "Cash on Delivery")</span>
                                            <span class="subtitle">@(isArabic ? "ادفع نقداً عند وصول طلبك" : "Pay cash upon delivery")</span>
                                        </div>
                                        <div class="check-circle"><i class="fas fa-check"></i></div>
                                    </div>
                                </label>

                                <!-- Credit Card -->
                                <label class="payment-method-card">
                                    <input type="radio" asp-for="PaymentMethod" value="CreditCard" name="PaymentMethod" onchange="updatePaymentSelection(this)" />
                                    <div class="card-content">
                                        <div class="method-icon"><i class="far fa-credit-card"></i></div>
                                        <div class="method-details">
                                            <span class="title">@(isArabic ? "بطاقة ائتمان / خصم" : "Credit / Debit Card")</span>
                                            <div class="card-logos">
                                                <i class="fab fa-cc-visa"></i>
                                                <i class="fab fa-cc-mastercard"></i>
                                            </div>
                                        </div>
                                        <div class="check-circle"><i class="fas fa-check"></i></div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Order Summary -->
                <aside class="checkout-sidebar">
                    <div class="summary-card-premium">
                        <div class="summary-header">
                            <h3>@(isArabic ? "ملخص الطلب" : "Order Summary")</h3>
                        </div>

                        <div class="checkout-items-scroll">
                            <div class="loader-placeholder" id="checkoutItemsLoader">
                                <i class="fas fa-circle-notch fa-spin"></i>
                            </div>
                            <!-- Items would be injected here -->
                        </div>

                        <div class="coupon-section">
                            <div class="coupon-input-wrapper">
                                <i class="fas fa-tag"></i>
                                <input asp-for="CouponCode" id="couponInput" placeholder="@(isArabic ? "كود الخصم" : "Coupon Code")" />
                                <button type="button" onclick="validateCoupon()">@(isArabic ? "تطبيق" : "Apply")</button>
                            </div>
                            <span id="couponFeedback" class="coupon-feedback"></span>
                        </div>

                        <div class="totals-section">
                            <div class="total-row">
                                <span>@(isArabic ? "المجموع الفرعي" : "Subtotal")</span>
                                <span id="subtotalDisplay" class="currency-price" data-base-price="0">...</span>
                            </div>
                            <div class="total-row">
                                <span>@(isArabic ? "الشحن" : "Shipping")</span>
                                <span id="shippingDisplay" class="currency-price" data-base-price="0">...</span>
                            </div>
                            <div class="total-row discount" id="discountRow" style="display:none;">
                                <span>@(isArabic ? "الخصم" : "Discount")</span>
                                <span id="discountDisplay" class="currency-price" data-base-price="0">-0.00 OMR</span>
                            </div>
                            <div class="total-divider"></div>
                            <div class="total-row grand-total">
                                <span>@(isArabic ? "الإجمالي" : "Total")</span>
                                <span id="totalDisplay" class="currency-price" data-base-price="0">...</span>
                            </div>
                        </div>

                        <button type="submit" class="btn-complete-order">
                            <span>@(isArabic ? "تأكيد الطلب" : "Place Order")</span>
                            <i class="fas fa-arrow-left"></i>
                        </button>

                        <div class="security-footer">
                            <i class="fas fa-lock"></i> @(isArabic ? "بياناتك محمية ومشفرة" : "Your data is encrypted & secure")
                        </div>
                    </div>
                </aside>
            </div>
        </form>
    </div>
</div>

<style>
    /* Checkout Page Styles */
    .checkout-page-wrapper {
        padding: 3rem 0 5rem;
        background: #f8f9fa;
        min-height: 100vh;
    }

    .checkout-header-centered {
        text-align: center;
        margin-bottom: 3rem;
    }

        .checkout-header-centered h1 {
            color: #002855;
            font-family: 'Playfair Display', serif;
            margin-bottom: 0.5rem;
        }

    .trust-badges {
        display: flex;
        justify-content: center;
        gap: 1rem;
        color: #6c757d;
        font-size: 0.9rem;
    }

        .trust-badges .badge {
            background: #fff;
            padding: 5px 10px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

    .checkout-grid-premium {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 2rem;
    }

    /* Cards */
    .checkout-card, .summary-card-premium {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        border: 1px solid rgba(0, 40, 85, 0.05);
        overflow: hidden;
    }

    .card-header-clean {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .step-circle {
        width: 32px;
        height: 32px;
        background: #002855;
        color: #fff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
    }

    .card-header-clean h2 {
        font-size: 1.25rem;
        margin: 0;
        color: #212529;
    }

    .card-body {
        padding: 2rem;
    }

    /* Floating Labels Form */
    .form-grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .form-group-float {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .form-input {
        width: 100%;
        padding: 1rem;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        font-size: 1rem;
        transition: 0.2s;
        background: #fff;
    }

        .form-input:focus {
            border-color: #002855;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 40, 85, 0.1);
        }

    .form-group-float label {
        position: absolute;
        left: 1rem;
        top: 1rem;
        color: #6c757d;
        transition: 0.2s;
        pointer-events: none;
        background: #fff;
        padding: 0 5px;
    }

    .form-input:focus ~ label,
    .form-input:not(:placeholder-shown) ~ label {
        top: -0.6rem;
        left: 0.8rem;
        font-size: 0.8rem;
        color: #002855;
        font-weight: 600;
    }

    /* RTL specific for floating labels */
    body.rtl .form-group-float label {
        left: auto;
        right: 1rem;
    }

    body.rtl .form-input:focus ~ label,
    body.rtl .form-input:not(:placeholder-shown) ~ label {
        right: 0.8rem;
        left: auto;
    }

    /* Payment Cards */
    .payment-selection-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .payment-method-card {
        cursor: pointer;
        position: relative;
    }

        .payment-method-card input {
            display: none;
        }

    .card-content {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 1.5rem;
        border: 2px solid #f1f3f5;
        border-radius: 12px;
        transition: 0.2s;
    }

    .payment-method-card input:checked + .card-content {
        border-color: #002855;
        background: rgba(0, 40, 85, 0.02);
    }

    .method-icon {
        font-size: 1.5rem;
        color: #002855;
        width: 40px;
        text-align: center;
    }

    .method-details {
        flex: 1;
    }

        .method-details .title {
            display: block;
            font-weight: 700;
            color: #212529;
        }

        .method-details .subtitle {
            font-size: 0.85rem;
            color: #6c757d;
        }

    .card-logos {
        margin-top: 5px;
        font-size: 1.2rem;
        color: #495057;
    }

    .check-circle {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border: 2px solid #dee2e6;
        color: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
    }

    .payment-method-card input:checked + .card-content .check-circle {
        background: #002855;
        border-color: #002855;
        color: #fff;
    }

    /* Summary Sidebar */
    .summary-card-premium {
        padding: 2rem;
        position: sticky;
        top: 100px;
    }

    .summary-header h3 {
        font-size: 1.25rem;
        margin-bottom: 1.5rem;
        color: #002855;
    }

    .coupon-section {
        margin-bottom: 2rem;
    }

    .coupon-input-wrapper {
        display: flex;
        align-items: center;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 5px;
        background: #f8f9fa;
    }

        .coupon-input-wrapper i {
            padding: 0 10px;
            color: #6c757d;
        }

        .coupon-input-wrapper input {
            border: none;
            background: transparent;
            flex: 1;
            outline: none;
        }

        .coupon-input-wrapper button {
            background: #002855;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }

    .totals-section {
        font-size: 0.95rem;
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
        color: #495057;
    }

    .total-divider {
        height: 1px;
        background: #e9ecef;
        margin: 1rem 0;
    }

    .total-row.grand-total {
        font-size: 1.25rem;
        font-weight: 700;
        color: #002855;
        margin-bottom: 0;
    }

    .btn-complete-order {
        width: 100%;
        padding: 1rem;
        background: #002855;
        color: #fff;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        margin-top: 2rem;
        cursor: pointer;
        transition: 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        box-shadow: 0 5px 15px rgba(0, 40, 85, 0.2);
    }

        .btn-complete-order:hover {
            background: #004080;
            transform: translateY(-2px);
        }

    .security-footer {
        text-align: center;
        margin-top: 1.5rem;
        font-size: 0.85rem;
        color: #2ecc71;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .checkout-grid-premium {
            grid-template-columns: 1fr;
        }

        .checkout-sidebar {
            order: -1;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Mock fetch details for UI demo
        // In real app, razor should populate these or AJAX
        document.getElementById('subtotalDisplay').setAttribute('data-base-price', '0');
    });

    function updatePaymentSelection(radio) {
        document.querySelectorAll('.payment-method-card').forEach(el => el.classList.remove('selected'));
        if(radio.checked) {
            radio.closest('.payment-method-card').classList.add('selected');
        }
    }

    async function validateCoupon() {
        // ... (Same validation logic as before) ...
    }
</script>