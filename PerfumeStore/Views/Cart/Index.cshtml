@model PerfumeStore.ViewModels.CartIndexViewModel
@{
    ViewData["Title"] = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar") ? "حقيبة التسوق" : "Shopping Bag";
    var isArabic = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar");
}

<!-- Page Header -->
<div class="page-header-shop animate-fade-up">
    <div class="container">
        <h1>@ViewData["Title"]</h1>
        <div class="breadcrumb-shop">
            <a href="/">@(isArabic ? "الرئيسية" : "Home")</a>
            <span class="separator">/</span>
            <span class="current">@ViewData["Title"]</span>
        </div>
    </div>
</div>

<section class="cart-section container animate-fade-up delay-1">
    @if (Model.Cart.Items?.Any() == true)
    {
        <div class="cart-layout-premium">
            <!-- Cart Items List -->
            <div class="cart-items-container">
                <div class="cart-table-header">
                    <div class="col-product">@(isArabic ? "المنتج" : "Product")</div>
                    <div class="col-price">@(isArabic ? "السعر" : "Price")</div>
                    <div class="col-qty">@(isArabic ? "الكمية" : "Quantity")</div>
                    <div class="col-total">@(isArabic ? "الإجمالي" : "Total")</div>
                    <div class="col-action"></div>
                </div>

                @foreach (var item in Model.Cart.Items)
                {
                    <div class="cart-item-row" id="cart-item-@item.Id">
                        <div class="col-product">
                            <div class="product-thumb">
                                <img src="@(item.Product?.ImageUrl ?? "/images/placeholder.jpg")" alt="@item.Product?.Name" />
                            </div>
                            <div class="product-details">
                                <h3>@(isArabic? item.Product?.NameAr : item.Product?.Name)</h3>
                                <span class="brand">@(isArabic? item.Product?.BrandAr : item.Product?.Brand)</span>
                                <span class="mobile-price">@item.UnitPrice OMR</span>
                            </div>
                        </div>
                        <div class="col-price desktop-only">
                            <span class="price">@item.UnitPrice OMR</span>
                        </div>
                        <div class="col-qty">
                            <div class="qty-selector-premium">
                                <form action="/Cart/Update" method="post" class="qty-form">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="cartItemId" value="@item.Id" />
                                    <button type="submit" name="quantity" value="@(item.Quantity - 1)" class="qty-btn" @(item.Quantity <= 1 ? "disabled" : "")><i class="fas fa-minus"></i></button>
                                    <input type="text" value="@item.Quantity" readonly class="qty-input" />
                                    <button type="submit" name="quantity" value="@(item.Quantity + 1)" class="qty-btn" @(item.Quantity >= item.Product?.StockQuantity ? "disabled" : "")><i class="fas fa-plus"></i></button>
                                </form>
                            </div>
                        </div>
                        <div class="col-total">
                            <span class="total-price">@((item.Quantity * item.UnitPrice).ToString("0.00")) <small>OMR</small></span>
                        </div>
                        <div class="col-action">
                            <form action="/Cart/Remove" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="cartItemId" value="@item.Id" />
                                <button type="submit" class="remove-btn-icon" title="@(isArabic ? "حذف" : "Remove")">
                                    <i class="far fa-trash-alt"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                }

                <div class="cart-actions-row">
                    <a href="/Products" class="btn-link-premium">
                        <i class="fas fa-arrow-right"></i> @(isArabic ? "متابعة التسوق" : "Continue Shopping")
                    </a>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="cart-summary-wrapper">
                <div class="cart-summary-card">
                    <h3>@(isArabic ? "ملخص الطلب" : "Order Summary")</h3>

                    <div class="summary-details">
                        <div class="summary-row">
                            <span>@(isArabic ? "المجموع الفرعي" : "Subtotal")</span>
                            <span class="value">@Model.Total.ToString("F2") OMR</span>
                        </div>
                        <div class="summary-row">
                            <span>@(isArabic ? "الشحن" : "Shipping")</span>
                            <span class="value">@(Model.Total >= 20 ? (isArabic ? "مجاني" : "Free") : "2.00 OMR")</span>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-row total">
                            <span>@(isArabic ? "الإجمالي الكلي" : "Grand Total")</span>
                            <span class="value gold">@((Model.Total + (Model.Total >= 20 ? 0 : 2)).ToString("F2")) OMR</span>
                        </div>
                        <p class="vat-note">@(isArabic ? "شامل ضريبة القيمة المضافة" : "Including VAT")</p>
                    </div>

                    <div class="coupon-area">
                        <div class="input-group-coupon">
                            <input type="text" id="couponCode" placeholder="@(isArabic ? "كود الخصم" : "Discount Code")" />
                            <button type="button" onclick="applyCoupon()" class="btn-apply">@(isArabic ? "تطبيق" : "Apply")</button>
                        </div>
                        <div id="couponMessage" class="coupon-msg"></div>
                    </div>

                    <a href="/Cart/Checkout" class="btn-checkout-premium">
                        <span>@(isArabic ? "إتمام الشراء الآمن" : "Secure Checkout")</span>
                        <i class="fas fa-lock"></i>
                    </a>

                    <div class="payment-icons">
                        <i class="fab fa-cc-visa"></i>
                        <i class="fab fa-cc-mastercard"></i>
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="empty-cart-premium">
            <div class="empty-icon-box">
                <i class="fas fa-shopping-bag"></i>
            </div>
            <h2>@(isArabic ? "حقيبة التسوق فارغة" : "Your Bag is Empty")</h2>
            <p>@(isArabic ? "يبدو أنك لم تضف أي عطور فاخرة بعد." : "Looks like you haven't added any luxury perfumes yet.")</p>
            <a href="/Products" class="btn-primary-premium">@(isArabic ? "اكتشف المجموعة" : "Discover Collection")</a>
        </div>
    }
</section>

<script>
    async function applyCoupon() {
        // Simple client-side simulation for UI feedback, logic handles in checkout
        const code = document.getElementById('couponCode').value;
        const msg = document.getElementById('couponMessage');
        if(!code) return;

        // You would typically validate via AJAX here
        msg.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

        // Simulate
        setTimeout(() => {
             // Just directing user to checkout where coupon logic usually resides or showing message
             window.location.href = `/Cart/Checkout?coupon=${code}`;
        }, 800);
    }
</script>